<!DOCTYPE html>
<html lang="en">
<head>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js" 
    integrity="sha512-WJXVjqeINVpi5XXJ2jn0BSCfp0y80IKrYh731gLRnkAS9TKc5KNt/OfLtu+fCueqdWniouJ1ubM+VI/hbo7POQ==" 
    crossorigin="anonymous" 
    referrerpolicy="no-referrer">
    </script>
    <!-- Includes the p5.collide2D addon library -->
    <script defer src="https://unpkg.com/p5.collide2d"></script>
    <!-- refrence external javasript -->
    <script src="script.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css" />  
    <link href="https://fonts.cdnfonts.com/css/common-pixel" rel="stylesheet">
    <style>
           @import url('https://fonts.cdnfonts.com/css/common-pixel');
   </style>
    
     <!-- Sound Library-->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.js" integrity="sha512-TU9AWtV5uUZPX8dbBAH8NQF1tSdigPRRT82vllAQ1Ke28puiqLA6ZVKxtUGlgrH6yWFnkKy+sE6luNEGH9ar0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body id="bodyl5">
    <div id = "image_text"></div>
    <h1 id = "display_text"></h1>
    <div id="image_pic"></div>
    <div id="box_text"><span id = "common_text">This is a common text. <br>Just a waste of space</span></div>
    <div id="stat_menu">
        <div id="line1"></div>
        <div id="line2"></div>
        <div id="line3"></div>
        <hr id="line4">
        <span id="healthstat">Health</span>
        <span id="healthn"></span>
        <span id="gold">Gold</span>
        <span id="goldn"></span>
        <span id="xp">Experience</span>
        <span id="xpn"></span>
    </div>

<script>
    let w = window.innerWidth;
    let h = window.innerHeight;
    let moveX = 150
    let moveY = 270
    let stuck = false;
    musiconce = 1
    //Hit variabls
    
    let once = 1;
    let once1 = 1;
    let once4 = 1;
    let once5 = 1;
    let once6 = 1;
    let once7 = 1;
    let once8 = 1;
    let once9 = 1;
    let once10 = 1;
    let once11 =1;
    let check1 = 1
    let countcheck = -1;
    let countcheck1=-1;
    let countcheck2=-1;
    let countcheck3=-1;
    let endchat1=false;
    let endchat2=false;
    let endchat3=false;
    let endchat4=false;
    let securitygaurd = false
    let merchant = false
    let blacksmith = false
    let priest = false
    let securityi;
    let merchanti;
    let blacksmithi;
    let priesti;
    let againt = false;
    let noheal;
    
    goback = true;
    gobackl5 = sessionStorage.getItem("gobackl5")
    //NN
    suattack = false;
    armor = sessionStorage.getItem("armor")
    gold = sessionStorage.getItem("gold")
    xp = sessionStorage.getItem("xp")
    health = sessionStorage.getItem("health")
    telebat = sessionStorage.getItem("telebat")
   if(telebat=="true"){
        telebat = false
        sessionStorage.setItem("telebat",telebat)
       moveX = sessionStorage.getItem("moveX")
       moveY = sessionStorage.getItem("moveY")
       moveX = parseInt(moveX)
       moveY = parseInt(moveY)

   }
   if(gobackl5=="true"){
        moveX=1700
        moveY=100

        gobackl5 = false
        sessionStorage.setItem("gobackl5",gobackl5)

   }

    
    ///////Place to buy goods. Potions and Enchanted armor. use security to cuation l6
function preload() {
    soundFormats('mp3',"ogg")
    levelm2 = loadSound('levelm2.mp3')
}
    function setup() {
        
        createCanvas(w,h);
        right = loadImage('right.png')
        left = loadImage("left.png")
        up = loadImage("up.png")
        down = loadImage("down.png")
        priesti=loadImage("priest.png")
        securityi = loadImage("ss.png")
        merchanti = loadImage("merchent.png")
        blacksmithi = loadImage("merchent2.png")
        levelm2.setVolume(1.0);
        levelm2.play()

        
    }
    function draw(){
        clear()
    //Music
    if((musiconce == 1)&&(music_start===true)){
            userStartAudio()
            musiconce=2
        }
        if (levelm2.isPlaying()){

        }
        else{
            levelm2.loop()
            }
        noStroke()
        fill(color(0,0,0,0.2))

        ///////////////////
        //if(fate ==1){
        //    suattack = true
        //}

        //Surprise Attack function

        if(suattack === true){
            suattack= false

            document.getElementById("display_text").innerHTML = ""
            document.getElementById("image_text").style.visibility = "visible"
            document.getElementById("common_text").style.visibility = "visible"
            randomin=Math.floor(Math.random() * 5)
            if(randomin ==1){
                document.getElementById("common_text").innerHTML = "I Will kill you<br>slowly"
            }
            else if(randomin == 2){
                document.getElementById("common_text").innerHTML = "I will use<br>your flesh as<br>my blanket"

            }
            else if(randomin == 3){
                document.getElementById("common_text").innerHTML = "Your head<br>will be my<br>trophy"

            }
            else if(randomin == 4){
                document.getElementById("common_text").innerHTML = "You are my<br>next meal"

            }
            else if(randomin == 5){
                document.getElementById("common_text").innerHTML = "I can taste<br>your defeat<br>and it tastes<br>like sugar"

            }
            else{
                document.getElementById("common_text").innerHTML = "I can taste<br>your defeat<br>and it tastes<br>like sugar"

            }


            document.getElementById("image_pic").style.visibility = "visible"
            document.getElementById("image_pic").style.backgroundImage = "url('Goblin_head.png')"
            stuck = true
           
            setTimeout(function(){

            onkeypress = function(){
               
                    document.getElementById("image_text").style.visibility = "hidden"
                    document.getElementById("common_text").style.visibility = "hidden"
                    document.getElementById("image_pic").style.visibility = "hidden"
                    stuck = false

                    once4 = 2
                    if (once1 == 1){
                        once1 = 2
                        place = "l5.html"
                        telebat = true
                        goblin = true
                        sessionStorage.setItem("levelup",levelup)
                        sessionStorage.setItem("once4",once4)
                        sessionStorage.setItem("moveX",moveX)
                        sessionStorage.setItem("moveY",moveY)
                        sessionStorage.setItem("telebat",telebat)
                        sessionStorage.setItem("place",place)
                        sessionStorage.setItem("health",health)
                        sessionStorage.setItem("goblin",goblin)
                        ranattack()
                    }
        
                }

            }, 2000); 

          

        }
        
        sessionStorage.setItem("health",health)
        sessionStorage.setItem("xp",xp)
        sessionStorage.setItem("gold",gold)


        if ((gold===undefined)||(gold===NaN)){
        gold = 0
         }
        if ((xp===undefined)||(xp===NaN)){
            xp = 0
        }
        gold = parseInt(gold)
        xp = parseInt(xp)
        
        
        if(xp>=100){
            xp-=100
            levelup = true
            sessionStorage.setItem("levelup",levelup)
        }
        health = parseInt(health)
        //Stats info & placement
        if((health >= 100)||(health>=10)){
            document.getElementById("healthn").style.right = "80%"
        }
        
        document.getElementById("goldn").innerHTML = gold
        document.getElementById("healthn").innerHTML = health
        document.getElementById("xpn").innerHTML = xp
        console.log(health)
        //makes sure that the health starts at 100
        if (armor=="true"){
            maxhealth = 150
        }
        else{
            maxhealth = 100
        }
        
       
        
        if (keyIsDown(65)) {
            if ((moveX > 0)&&(stuck === false)){
                moveX = moveX -5;
                
                moveleft = true
                moveup = false
                movedown = false
                
                setTimeout(() => { fate = Math.floor(Math.random() * (20 - 1 + 1)) + 1; }, 2000);

            }
            
        }
    if (keyIsDown(68)){
        if ((moveX < 1820)&&(stuck === false)){
            moveX = moveX +5;
            moveright = true
            moveleft = false
            moveup = false
            movedown = false
            setTimeout(() => { fate = Math.floor(Math.random() * (20 - 1 + 1)) + 1; }, 2000);

            
        }
        

    }
    if (keyIsDown(83)){
        if ((moveY < 675)&&(stuck === false)){
            moveY = moveY +5;
            movedown = true
            moveup = false
            moveleft = false
            setTimeout(() => { fate = Math.floor(Math.random() * (20 - 1 + 1)) + 1; }, 2000);


        }

    }
    if (keyIsDown(87)){
        if ((moveY > 0)&&(stuck === false)){
        
            moveY = moveY -5;
            moveup = true
            movedown = false
            moveleft = false
            setTimeout(() => { fate = Math.floor(Math.random() * (20 - 1 + 1)) + 1; }, 2000);

        }
    }
    rect(moveX,moveY,100,100)
        if (moveup === true){
            image(up,moveX,moveY,150,150)
            movedown = false
            moveleft = false

        }
        else if(movedown === true){
            image(down,moveX,moveY,150,100)
            moveup = false
            moveleft = false
        }
        else if(moveleft === true){
            image(left,moveX,moveY,110,130)
            moveup = false
            movedown = false
        }
        else if (moveright === true){
            image(right,moveX,moveY,150,170)
        }
        else{
            image(right,moveX,moveY,150,150)
        }

    //LOADED@#!

        image(priesti,1250,80,100,120)
        image(blacksmithi,1000,250,110,100)
        image(merchanti,1100,500,120,100)
        image(securityi,1650,100,150,100)

        priest=collideRectRect(moveX,moveY,100,100,1250,80,100,120)
        securitygaurd = collideRectRect(moveX,moveY,100,100,1650,100,150,100)
        merchant = collideRectRect(moveX,moveY,100,100,1100,500,120,100)
        blacksmith = collideRectRect(moveX,moveY,100,100,1000,250,110,100)

    if((priest===true)&&(endchat1===false)){
        document.getElementById("display_text").innerHTML = "Press 'c' to talk to blind priest(?)"

        if ((keyCode === 67)||(againt === true)){
            againt = true
            document.getElementById("display_text").innerHTML = ""
            document.getElementById("image_text").style.visibility = "visible"
            document.getElementById("common_text").style.visibility = "visible"
            document.getElementById("image_pic").style.visibility = "visible"
            document.getElementById("image_pic").style.backgroundImage = "url('phead.png')"
            document.getElementById("image_pic").style.transform = "scaleX(1)"
            document.getElementById("common_text").innerHTML = "oh its you"
            stuck = true
            onkeypress = function(){
                countcheck += 1
            
                
            }
            if (countcheck==0){
                    document.getElementById("common_text").innerHTML = "This wont work"
                    countcheck = 1
                
                }
            else if (countcheck == 1){
                    document.getElementById("common_text").innerHTML = "It seems you<br>are still dandy"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('head.png')"
                    
                }
            else if (countcheck == 2){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "Oh brave knight<br>surely I thought<br>you were dead"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('phead.png')"
                }
            else if(countcheck ==3){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "It is not much<br> but here is <br>some gold I <br>got from begging"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('phead.png')"
                    if(once5==1){
                        once5=2
                        gold+=20
                    }

            }
            else if(countcheck ==4){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "Thank you<br>good luck<br>and don't die"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('head.png')"

            }

            else if(countcheck ==5){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "yep"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('phead.png')"

            }
            
            else if (countcheck == 6){
                    document.getElementById("image_text").style.visibility = "hidden"
                    document.getElementById("common_text").style.visibility = "hidden"
                    document.getElementById("image_pic").style.visibility = "hidden"
                    stuck = false
                    againt= false
                    endchat1 = true
                    

                  
                }
        }
    }
    else{
    }

    if((merchant===true)&&(endchat2===false)){
        document.getElementById("display_text").innerHTML = "Press 'c' to buy a health potion for 20 gold"

        if ((keyCode === 67)||(againt === true)){
            againt = true
            stuck = true
            if((once6==1)&&(gold<20)){
                noheal = true
                once6=2
                
            }
            else if((once6==1)&&(gold>=20)){
                noheal = false
                gold-=20
                health+=70
                sessionStorage.setItem("gold",gold)
                if(health>maxhealth){
                    health = maxhealth
                }
                once6=2
                
            }

            onkeypress = function(){
                
                countcheck1 += 1
                
            
                
            }
            if (countcheck1==0){
                    document.getElementById("common_text").innerHTML = "This wont work"
                    countcheck1 = 1
                
                }
            else if ((countcheck1 == 1)&&(noheal===true)){
                    document.getElementById("image_text").style.visibility = "visible"
                    document.getElementById("common_text").style.visibility = "visible"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("common_text").innerHTML = "You dont have<br>enought money"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('mhead.png')"
                    document.getElementById("display_text").innerHTML = ""
                    
                }
            else if ((countcheck1 == 2)&&(noheal===true)){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "I apologize"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('head.png')"
                }
            else if((countcheck1 == 3)&&(noheal===true)){
                    document.getElementById("image_text").style.visibility = "hidden"
                    document.getElementById("common_text").style.visibility = "hidden"
                    document.getElementById("image_pic").style.visibility = "hidden"
                    stuck = false
                    againt= false
                    endchat2=true


            }
            else if((countcheck1 == 1)&&(noheal===false)){
                    document.getElementById("image_text").style.visibility = "visible"
                    document.getElementById("common_text").style.visibility = "visible"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "Just follow the<br>directions"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('mhead.png')"

            }

            else if((countcheck1 == 2)&&(noheal===false)){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "good day"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('head.png')"

            }
            
            else if((countcheck1 == 3)&&(noheal===false)){
                    document.getElementById("image_text").style.visibility = "hidden"
                    document.getElementById("common_text").style.visibility = "hidden"
                    document.getElementById("image_pic").style.visibility = "hidden"
                    stuck = false
                    againt= false
                    endchat2=true

                  
                }
        }
    }
    else{
        once6=1
    }
    
    

    if((blacksmith===true)&&(endchat3===false)){
        document.getElementById("display_text").innerHTML = "Press 'c' to buy Mithril Armor for 120 gold"
        if ((keyCode === 67)||(againt === true)){
            againt = true
            stuck = true
            if(once9==1){
                countcheck = 0
                once9=2
            }
            if((once7==1)&&(gold<120)){
                noheal = true
                once7=2
                
            }
            else if((once7==1)&&(gold>=120)){
                noheal = false
                gold-=120
                armor = true
                sessionStorage.setItem("armor",armor)
                once7=2
                
            }

            onkeypress = function(){
                if((noheal===true)||(noheal===false)){
                    countcheck2 += 1
                }
            
                
            }
            if (countcheck2==0){
                    document.getElementById("common_text").innerHTML = "This wont work"
                    countcheck2 = 1
                
                }
            else if ((countcheck2 == 1)&&(noheal===true)){
                    document.getElementById("display_text").innerHTML = ""
                    document.getElementById("image_text").style.visibility = "visible"
                    document.getElementById("common_text").style.visibility = "visible"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("common_text").innerHTML = "You dont have<br>enought money"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('mhead.png')"
                    
                }
            else if ((countcheck2 == 2)&&(noheal===true)){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "I apologize"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('head.png')"
                }
            else if((countcheck2 == 3)&&(noheal===true)){
                    document.getElementById("image_text").style.visibility = "hidden"
                    document.getElementById("common_text").style.visibility = "hidden"
                    document.getElementById("image_pic").style.visibility = "hidden"
                    stuck = false
                    againt= false
                    endchat3=true


            }
            if((countcheck2 == 1)&&(noheal===false)){
                    document.getElementById("display_text").innerHTML = ""
                    document.getElementById("image_text").style.visibility = "visible"
                    document.getElementById("common_text").style.visibility = "visible"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "best armor<br>I have ever<br>made"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('mhead.png')"

            }

            else if((countcheck2 == 2)&&(noheal===false)){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "good day"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('head.png')"

            }
            
            else if((countcheck2 == 3)&&(noheal===false)){
                    document.getElementById("image_text").style.visibility = "hidden"
                    document.getElementById("common_text").style.visibility = "hidden"
                    document.getElementById("image_pic").style.visibility = "hidden"
                    stuck = false
                    againt= false
                    endchat3=true

                  
                }
        }

    }
    else{
        once7=1

    }

    if((securitygaurd===true)&&(endchat4===false)){
        document.getElementById("display_text").innerHTML = "Press 'c' to talk to imperial gaurd(!)"

        if ((keyCode === 67)||(againt === true)){
            againt = true
            document.getElementById("display_text").innerHTML = ""
            document.getElementById("image_text").style.visibility = "visible"
            document.getElementById("common_text").style.visibility = "visible"
            document.getElementById("image_pic").style.visibility = "visible"
            document.getElementById("image_pic").style.backgroundImage = "url('head.png')"
            document.getElementById("image_pic").style.transform = "scaleX(1)"
            document.getElementById("common_text").innerHTML = "it is a<br>fine day<br>today"
            stuck = true
        
            onkeypress = function(){
                countcheck3 += 1
            
                
            }
            if (countcheck3==0){
                    document.getElementById("common_text").innerHTML = "This wont work"
                    countcheck = 1
                
                }
            else if (countcheck3 == 1){
                    document.getElementById("common_text").innerHTML = "Yes it is<br>As a word<br> of caution..."
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('sshead.png')"
                    
                }
            else if (countcheck3 == 2){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "There are<br>reports of<br> a big mushroom<br>ahead<br> the fungus makes<br>the sand black"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('sshead.png')"
                }
            else if(countcheck3 ==3){
                    document.getElementById("image_pic").style.transform = ""
                    document.getElementById("common_text").innerHTML = "thank you for<br>the warning"
                    document.getElementById("image_pic").style.visibility = "visible"
                    document.getElementById("image_pic").style.transform = "scaleX(1)"
                    document.getElementById("image_pic").style.backgroundImage = "url('head.png')"
                  
            }
            else if (countcheck3 == 4){
                    document.getElementById("image_text").style.visibility = "hidden"
                    document.getElementById("common_text").style.visibility = "hidden"
                    document.getElementById("image_pic").style.visibility = "hidden"
                    stuck = false
                    againt= false
                    endchat4 = true

                  
                }
        }

    }
    else{

        
    }
    





    gobacktol4=collideRectRect(moveX,moveY,50,50,30,275,50,100)
    gotol6=collideRectRect(moveX,moveY,150,150,1880,255,100,100)
    
    if(gobacktol4===true){
        if(once==1){
            once+=1
            window.location.href = "l4.html"
            gobackl4=true
            sessionStorage.setItem("gobackl4",gobackl4)
        }
    }
    if(gotol6===true){
        if(once==1){
            once+=1
            window.location.href = "l6.html"
        }
    }
    
}



function mouseMoved() {
            music_start = true
        }


</script>

    
</body>
</html>